#!/usr/bin/env npx ts-node

/**
 * 용어 10배 확장 스크립트
 * 20개 도메인 × 100개 → 20개 도메인 × 1,000개 = 20,000개
 *
 * 사용법:
 *   npx ts-node src/scripts/expand-terms-10x.ts --domain=medical --batch=1
 *   npx ts-node src/scripts/expand-terms-10x.ts --domain=medical --batch=2
 *   ...
 *   npx ts-node src/scripts/expand-terms-10x.ts --domain=medical --batch=9
 *
 * 각 배치당 100개 추가 (총 9배치 = 900개 추가)
 */

import * as fs from 'fs';
import * as path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// ============ 도메인별 확장 용어 카테고리 ============

const DOMAIN_EXPANSION: Record<string, { categories: string[]; terms: string[][] }> = {
  medical: {
    categories: [
      '진료과별 용어',      // batch 1
      '검사/진단 용어',     // batch 2
      '약물/처방 용어',     // batch 3
      '수술/시술 용어',     // batch 4
      '응급/외상 용어',     // batch 5
      '재활/물리치료',      // batch 6
      '정신건강 용어',      // batch 7
      '한의학 용어',        // batch 8
      '의료행정/보험',      // batch 9
    ],
    terms: [
      // batch 1: 진료과별 용어 (100개)
      ['내과', '외과', '정형외과', '신경외과', '흉부외과', '성형외과', '피부과', '안과', '이비인후과', '비뇨기과',
       '산부인과', '소아과', '정신건강의학과', '재활의학과', '가정의학과', '응급의학과', '마취통증의학과', '영상의학과', '진단검사의학과', '병리과',
       '순환기내과', '소화기내과', '호흡기내과', '내분비내과', '신장내과', '혈액종양내과', '류마티스내과', '감염내과', '알레르기내과', '신경과',
       '척추센터', '관절센터', '암센터', '심장센터', '뇌졸중센터', '외상센터', '통증클리닉', '비만클리닉', '당뇨클리닉', '갑상선클리닉',
       '피부미용', '레이저클리닉', '탈모클리닉', '알레르기클리닉', '수면클리닉', '건강검진센터', '예방접종센터', '모유수유클리닉', '산전관리', '산후조리',
       '소아심장', '소아신경', '소아알레르기', '소아내분비', '발달클리닉', '청소년클리닉', '노인의학', '완화의료', '호스피스', '재택의료',
       '직업환경의학', '항공의학', '스포츠의학', '미용의학', '비만대사외과', '이식외과', '혈관외과', '유방외과', '갑상선외과', '대장항문외과',
       '두경부외과', '구강외과', '안면윤곽', '눈성형', '코성형', '가슴성형', '지방흡입', '리프팅', '보톡스', '필러',
       '백내장', '녹내장', '망막', '각막', '사시', '굴절이상', '라식', '라섹', '렌즈삽입술', '노안교정',
       '청력검사', '이명', '어지럼증', '수면무호흡', '코골이', '비염', '축농증', '편도선', '성대', '음성장애'],
      // batch 2: 검사/진단 용어 (100개)
      ['혈액검사', '소변검사', '대변검사', '객담검사', '뇌척수액검사', '골수검사', '조직검사', '세포검사', '배양검사', '항생제감수성검사',
       'X선촬영', 'CT촬영', 'MRI촬영', '초음파검사', '내시경검사', '대장내시경', '위내시경', '기관지내시경', '방광경검사', '관절경검사',
       '심전도', '심초음파', '운동부하검사', '홀터검사', '혈압측정', '동맥경화검사', '말초혈관검사', '경동맥초음파', '심장CT', '관상동맥조영술',
       '뇌파검사', '근전도검사', '신경전도검사', '유발전위검사', '수면다원검사', '자율신경검사', '인지기능검사', '우울증검사', '불안검사', '치매검사',
       '폐기능검사', '기관지유발검사', '운동유발검사', '흉부CT', 'PET-CT', '뼈스캔', '갑상선스캔', '신장스캔', '심근스캔', '뇌혈류스캔',
       '알레르기검사', '피부반응검사', '혈청검사', '자가항체검사', '면역검사', 'HIV검사', 'B형간염검사', 'C형간염검사', '결핵검사', '성병검사',
       '유전자검사', '염색체검사', '산전검사', '양수검사', '융모막검사', '기형아검사', '신생아선별검사', '대사이상검사', '청력선별검사', '시력검사',
       '골밀도검사', '체성분분석', '기초대사량검사', '성장판검사', '자세분석', '보행분석', '균형검사', '근력검사', '유연성검사', '심폐지구력검사',
       '간기능검사', '신기능검사', '갑상선기능검사', '부신기능검사', '성호르몬검사', '당부하검사', '인슐린검사', '종양표지자검사', '염증표지자검사', '응고검사',
       '세균배양', '바이러스검사', 'PCR검사', '항원검사', '항체검사', '약물농도검사', '중금속검사', '영양상태검사', '비타민검사', '미네랄검사'],
      // batch 3: 약물/처방 용어 (100개)
      ['처방약', '일반의약품', '전문의약품', '마약성진통제', '항생제', '소염진통제', '해열제', '진해거담제', '항히스타민제', '위장약',
       '혈압약', '당뇨약', '고지혈증약', '혈전용해제', '항응고제', '이뇨제', '베타차단제', '칼슘차단제', 'ACE억제제', 'ARB',
       '인슐린', '경구혈당강하제', '갑상선약', '골다공증약', '통풍약', '류마티스약', '면역억제제', '항암제', '호르몬제', '피임약',
       '수면제', '안정제', '항우울제', '항불안제', '항정신병약', '항경련제', '파킨슨약', '치매약', '두통약', '편두통약',
       '안약', '점안액', '안연고', '콘택트렌즈세척액', '인공눈물', '귀약', '점이액', '코약', '비강스프레이', '구강청결제',
       '연고', '크림', '로션', '겔', '파스', '습포제', '테이프제', '스프레이', '폼제', '패치',
       '주사제', '수액', '영양제주사', '비타민주사', '철분주사', '백신', '면역글로불린', '혈액제제', '알부민', '조영제',
       '좌약', '질정', '관장액', '흡입제', '네뷸라이저', '산소', '아산화질소', '마취제', '근이완제', '응급약',
       '한약', '첩약', '환약', '산제', '탕약', '고약', '침', '뜸', '부항', '추나',
       '건강기능식품', '프로바이오틱스', '오메가3', '비타민D', '칼슘제', '철분제', '아연', '마그네슘', '콜라겐', '글루코사민'],
      // batch 4: 수술/시술 용어 (100개)
      ['수술', '시술', '전신마취', '국소마취', '척추마취', '경막외마취', '신경차단', '수술실', '회복실', '중환자실',
       '개복수술', '복강경수술', '로봇수술', '내시경수술', '최소침습수술', '미세수술', '현미경수술', '레이저수술', '냉동수술', '고주파수술',
       '충수절제술', '담낭절제술', '탈장수술', '치질수술', '대장절제술', '위절제술', '간절제술', '췌장수술', '비장절제술', '신장적출술',
       '갑상선절제술', '유방절제술', '림프절절제술', '부신절제술', '난소절제술', '자궁적출술', '제왕절개', '자연분만', '유도분만', '무통분만',
       '관상동맥우회술', '판막수술', '대동맥수술', '말초혈관수술', '정맥류수술', '동정맥루수술', '스텐트삽입술', '풍선확장술', '색전술', '혈전제거술',
       '뇌종양수술', '뇌동맥류수술', '뇌출혈수술', '뇌경색수술', '척추수술', '추간판절제술', '척추유합술', '척추성형술', '신경감압술', '말초신경수술',
       '인공관절수술', '관절경수술', '인대재건술', '골절수술', '골접합술', '외고정술', '절골술', '연골수술', '건봉합술', '힘줄수술',
       '백내장수술', '녹내장수술', '망막수술', '유리체수술', '각막이식', '눈꺼풀수술', '사시수술', '코수술', '비중격수술', '부비동수술',
       '편도선수술', '아데노이드수술', '귀수술', '고막수술', '이소골수술', '인공와우수술', '후두수술', '기관절개술', '식도수술', '두경부암수술',
       '피부이식', '피판수술', '지방이식', '봉합술', '절개배농', '조직확장술', '흉터제거술', '화상수술', '성형재건술', '미용수술'],
      // batch 5: 응급/외상 용어 (100개)
      ['응급실', '응급환자', '중증응급', '경증응급', '응급이송', '구급차', '119구급대', '응급처치', '심폐소생술', 'AED',
       '기도확보', '인공호흡', '흉부압박', '제세동', '기관삽관', '정맥확보', '수액공급', '산소공급', '응급투약', '쇼크치료',
       '심정지', '심근경색', '뇌졸중', '호흡정지', '의식불명', '혼수상태', '경련', '발작', '중독', '과다복용',
       '외상', '타박상', '찰과상', '열상', '자상', '관통상', '둔상', '압궤손상', '폭발손상', '총상',
       '골절', '탈구', '염좌', '인대손상', '힘줄파열', '근육파열', '개방골절', '폐쇄골절', '분쇄골절', '병적골절',
       '두부외상', '뇌진탕', '뇌좌상', '뇌출혈', '두개골골절', '경추손상', '척수손상', '마비', '사지마비', '하반신마비',
       '흉부외상', '기흉', '혈흉', '심장눌림증', '대동맥파열', '갈비뼈골절', '흉골골절', '폐좌상', '기관손상', '식도파열',
       '복부외상', '간손상', '비장파열', '신장손상', '장파열', '방광파열', '횡격막손상', '복막염', '장폐색', '내출혈',
       '화상', '1도화상', '2도화상', '3도화상', '열탕화상', '화학화상', '전기화상', '흡입화상', '동상', '저체온증',
       '익수', '질식', '교상', '독사교상', '벌쏘임', '알레르기쇼크', '아나필락시스', '열사병', '일사병', '고산병'],
      // batch 6: 재활/물리치료 용어 (100개)
      ['재활의학', '물리치료', '작업치료', '언어치료', '인지치료', '심리치료', '운동치료', '수치료', '열치료', '전기치료',
       '도수치료', '관절가동술', '연부조직기법', '근막이완술', '신경가동술', '척추교정', '자세교정', '보행훈련', '균형훈련', '협응훈련',
       '근력강화', '지구력훈련', '유연성훈련', '스트레칭', '관절운동', '능동운동', '수동운동', '저항운동', '등척성운동', '등장성운동',
       '초음파치료', '레이저치료', 'TENS', '간섭파치료', '자기장치료', '충격파치료', '온열치료', '냉치료', '파라핀욕', '적외선치료',
       '수중치료', '수중걷기', '수중에어로빅', '자쿠지', '월풀', '아쿠아마사지', '부력운동', '저항운동풀', '온천치료', '해수치료',
       '보조기', '의지', '의수', '의족', '휠체어', '보행기', '목발', '지팡이', '허리보조기', '무릎보조기',
       '발목보조기', '손목보조기', '경추보조기', '척추보조기', '골반보조기', '보행보조기구', '이동보조기구', '일상생활보조기구', '자세유지기구', '욕창방지기구',
       '일상생활동작', '기본적일상생활', '수단적일상생활', '식사훈련', '옷입기훈련', '개인위생훈련', '이동훈련', '가사훈련', '직업훈련', '여가활동',
       '연하재활', '삼킴장애', '구강운동', '연하검사', '연하식이', '경관영양', '언어장애', '실어증', '조음장애', '음성장애',
       '인지재활', '기억력훈련', '주의력훈련', '집행기능훈련', '시지각훈련', '문제해결훈련', '컴퓨터인지재활', '가상현실재활', '로봇재활', '뇌-컴퓨터인터페이스'],
      // batch 7: 정신건강 용어 (100개)
      ['정신건강', '정신질환', '정신장애', '신경증', '정신병', '조현병', '양극성장애', '우울장애', '불안장애', '공황장애',
       '강박장애', '외상후스트레스장애', '적응장애', '해리장애', '신체화장애', '건강염려증', '전환장애', '인위성장애', '식이장애', '거식증',
       '폭식증', '수면장애', '불면증', '과수면증', '수면무호흡', '하지불안증후군', '악몽', '몽유병', '이갈이', '수면마비',
       '주의력결핍과잉행동장애', '자폐스펙트럼장애', '학습장애', '틱장애', '투렛장애', '분리불안장애', '선택적함묵증', '반응성애착장애', '품행장애', '적대적반항장애',
       '알코올사용장애', '약물사용장애', '도박장애', '게임장애', '인터넷사용장애', '니코틴의존', '카페인중독', '금단증상', '내성', '의존성',
       '성격장애', '편집성성격장애', '조현성성격장애', '분열형성격장애', '반사회성성격장애', '경계성성격장애', '연극성성격장애', '자기애성성격장애', '회피성성격장애', '의존성성격장애',
       '치매', '알츠하이머병', '혈관성치매', '루이소체치매', '전두측두엽치매', '경도인지장애', '섬망', '기억장애', '인지기능저하', '행동심리증상',
       '자살', '자해', '자살사고', '자살시도', '자살예방', '위기개입', '응급정신의학', '정신과응급', '비자발적입원', '강제입원',
       '정신치료', '인지행동치료', '변증법적행동치료', '수용전념치료', '정신역동치료', '지지치료', '집단치료', '가족치료', '부부치료', '놀이치료',
       '약물치료', '항정신병약물', '항우울제', '기분안정제', '항불안제', '수면제', '정신자극제', '인지기능개선제', '전기경련치료', '경두개자기자극술'],
      // batch 8: 한의학 용어 (100개)
      ['한의학', '한의원', '한의사', '침술', '뜸', '부항', '추나', '한약', '첩약', '탕약',
       '사상체질', '태양인', '태음인', '소양인', '소음인', '체질진단', '체질침', '체질한약', '사상의학', '팔체질의학',
       '경락', '경혈', '십이경맥', '기경팔맥', '수태음폐경', '수양명대장경', '족양명위경', '족태음비경', '수소음심경', '수태양소장경',
       '족태양방광경', '족소음신경', '수궐음심포경', '수소양삼초경', '족소양담경', '족궐음간경', '임맥', '독맥', '대맥', '충맥',
       '기', '혈', '진액', '정', '신', '기혈', '음양', '오행', '장부', '오장육부',
       '간', '심', '비', '폐', '신장', '담', '소장', '위', '대장', '방광',
       '풍', '한', '서', '습', '조', '화', '외감', '내상', '허증', '실증',
       '보법', '사법', '온법', '청법', '토법', '하법', '한법', '화법', '치법', '변증시치',
       '망진', '문진', '문진', '절진', '설진', '맥진', '복진', '경혈진단', '사진', '팔강',
       '보기', '보혈', '보음', '보양', '활혈', '화어', '이기', '소담', '청열', '해독'],
      // batch 9: 의료행정/보험 용어 (100개)
      ['건강보험', '의료보험', '국민건강보험', '건강보험공단', '건강보험심사평가원', '요양급여', '비급여', '본인부담금', '본인부담상한제', '산정특례',
       '의료급여', '차상위계층', '기초생활수급자', '장애인의료비', '노인장기요양보험', '장기요양등급', '장기요양급여', '재가급여', '시설급여', '특별현금급여',
       '진료비', '입원비', '수술비', '검사비', '약제비', '처치비', '재료대', '상급병실료', '선택진료비', '비급여진료비',
       '진단서', '소견서', '입퇴원확인서', '진료기록사본', '처방전사본', '진료비영수증', '진료비세부내역서', '장애진단서', '후유장해진단서', '사망진단서',
       '병가', '입원확인서', '통원확인서', '산재보험', '업무상재해', '출퇴근재해', '직업병', '산재승인', '요양급여신청', '휴업급여',
       '실손보험', '실손의료비', '자기부담금', '보험금청구', '보험사고접수', '보험심사', '보험금지급', '보험사기', '보험계약', '보험약관',
       '의료분쟁', '의료사고', '의료과실', '의료소송', '의료조정', '의료중재', '의료배상', '의료윤리', '환자권리', '고지의무',
       '진료예약', '진료접수', '진료대기', '수납', '퇴원수속', '외래진료', '입원진료', '응급진료', '당일수술', '외래수술',
       '전자의무기록', '처방전달시스템', '의료정보시스템', '원격의료', '비대면진료', '화상진료', '전화상담', '건강상담', '2차소견', '해외환자유치',
       '의료기관인증', '환자안전', '감염관리', '의료질평가', '진료지침', '임상경로', '환자경험평가', '의료서비스', '병원경영', '의료인력'],
    ],
  },
  // 다른 도메인들도 동일한 구조로 추가 가능
};

// 기본 스키마 생성 함수
function generateTerm(
  korean: string,
  domain: string,
  category: string,
  existingTerms: any[]
): any {
  const slug = korean
    .toLowerCase()
    .replace(/\s+/g, '-')
    .replace(/[^a-z0-9가-힣-]/g, '');

  // 이미 존재하는지 확인
  if (existingTerms.some(t => t.korean === korean || t.slug === slug)) {
    return null;
  }

  return {
    slug: `${slug}-${Date.now() % 10000}`,
    korean,
    vietnamese: `[${korean} 베트남어]`,
    hanja: null,
    hanjaReading: null,
    meaningKo: `${korean}은(는) ${category} 분야의 전문 용어입니다. 통역 시 정확한 의미 전달과 문맥에 맞는 표현 사용이 중요합니다. 한국과 베트남의 ${domain} 분야에서 이 용어가 사용되는 방식과 맥락의 차이를 이해하고 설명할 수 있어야 합니다.`,
    meaningVi: `${korean} là thuật ngữ chuyên môn trong lĩnh vực ${category}. Khi phiên dịch cần truyền đạt chính xác ý nghĩa và sử dụng biểu đạt phù hợp với ngữ cảnh.`,
    pronunciation: korean,
    context: category,
    culturalNote: `한국과 베트남의 ${domain} 분야에서 '${korean}'에 대한 인식과 사용 방식에는 차이가 있을 수 있습니다. 통역 시 양국의 문화적 맥락을 고려하여 적절히 설명하는 것이 좋습니다.`,
    commonMistakes: [
      {
        mistake: `${korean}을(를) 직역`,
        correction: '해당 분야에서 통용되는 표현 사용',
        explanation: '전문 용어는 직역보다 업계 표준 표현을 사용해야 이해도가 높습니다.',
      },
      {
        mistake: '단위/기준 차이 무시',
        correction: '양국에서 사용하는 기준으로 환산 설명',
        explanation: '기준이나 단위가 다를 수 있어 정확한 환산이 필요합니다.',
      },
      {
        mistake: '문화적 맥락 누락',
        correction: '양국의 문화적 차이를 고려한 설명 추가',
        explanation: '같은 용어도 문화에 따라 다르게 이해될 수 있습니다.',
      },
    ],
    examples: [
      {
        ko: `${korean}에 대해 설명해 주세요.`,
        vi: `Xin hãy giải thích về ${korean}.`,
        situation: 'formal',
      },
      {
        ko: `${korean} 확인 부탁드립니다.`,
        vi: `Vui lòng kiểm tra ${korean}.`,
        situation: 'onsite',
      },
      {
        ko: `${korean} 관련 문의드립니다.`,
        vi: `Tôi muốn hỏi về ${korean}.`,
        situation: 'informal',
      },
    ],
    relatedTerms: [],
  };
}

async function main() {
  const args = process.argv.slice(2);
  const domainArg = args.find(a => a.startsWith('--domain='));
  const batchArg = args.find(a => a.startsWith('--batch='));

  if (!domainArg || !batchArg) {
    console.log('사용법: npx ts-node expand-terms-10x.ts --domain=medical --batch=1');
    console.log('batch: 1-9 (각 100개씩 추가)');
    process.exit(1);
  }

  const domain = domainArg.split('=')[1];
  const batch = parseInt(batchArg.split('=')[1], 10);

  if (batch < 1 || batch > 9) {
    console.log('batch는 1-9 사이의 값이어야 합니다.');
    process.exit(1);
  }

  const expansion = DOMAIN_EXPANSION[domain];
  if (!expansion) {
    console.log(`도메인 '${domain}'에 대한 확장 데이터가 없습니다.`);
    console.log('사용 가능한 도메인:', Object.keys(DOMAIN_EXPANSION).join(', '));
    process.exit(1);
  }

  const termsDir = path.join(__dirname, '../data/terms');
  const filePath = path.join(termsDir, `${domain}.json`);

  if (!fs.existsSync(filePath)) {
    console.log(`파일을 찾을 수 없습니다: ${filePath}`);
    process.exit(1);
  }

  const existingTerms: any[] = JSON.parse(fs.readFileSync(filePath, 'utf-8'));
  const category = expansion.categories[batch - 1];
  const newTermWords = expansion.terms[batch - 1];

  console.log(`\n=== ${domain} 도메인 확장 (배치 ${batch}/9) ===`);
  console.log(`카테고리: ${category}`);
  console.log(`기존 용어: ${existingTerms.length}개`);
  console.log(`추가 예정: ${newTermWords.length}개\n`);

  let addedCount = 0;
  const newTerms: any[] = [];

  for (const word of newTermWords) {
    const term = generateTerm(word, domain, category, [...existingTerms, ...newTerms]);
    if (term) {
      newTerms.push(term);
      addedCount++;
    }
  }

  if (newTerms.length > 0) {
    const allTerms = [...existingTerms, ...newTerms];
    fs.writeFileSync(filePath, JSON.stringify(allTerms, null, 2) + '\n');
    console.log(`✅ ${addedCount}개 용어 추가 완료`);
    console.log(`총 용어 수: ${allTerms.length}개`);
  } else {
    console.log('추가할 새 용어가 없습니다 (이미 존재하거나 중복)');
  }

  console.log('\n');
}

main();
